
******************************************************************

           Native installation of the Open64 compiler

              by Peng Zhao, University of Alberta

******************************************************************

Warning: 

I found the native installation of Open64 or ORC is system
dependent. There are different header files and glibc on different
versions of linux, thus this summary may not fit all systems. For
example, I have met two problems that other guys did not meet in their
systems: 

 1) the HOSTTYPE env variable on my ITANIUM box is "unknown".  Due to
 this, in osprey1.0/libkapi/Makefile.inc(check the line 720), my
 GCC_BIN is set as "@echo HOSTTYPE undefined", thus the building
 cannot go on. I have to manually set up this env variable or modify
 osprey1.0/libkapi/Makefile.inc:

                  HOSTTYPE=ia64 

 2) the second problem is still in the libkapi, the ipfec_targ_gen
 core dumped. It seems that there is a bug in my glibc: I traced the
 core dump position at two calls to strncpy() in kapi_ia64.c . strncpy
 calls memchr() and memchr core dumps. After replacing strncpy() with
 strcpy(), the compilation goes fine.




================================================================

Information of my Itanium system

>cat /proc/version

Linux version 2.4.7-2smp (bhcompile@boris.devel.redhat.com) (gcc version
2.96 20000731 (Red Hat Linux 7.1 2.96-96)) #1 SMP Tue Aug 14 04:31:14 EDT
2001

>gcc -v
Reading specs from
/usr/lib/gcc-lib/ia64-redhat-linux/2.96/specs gcc version 2.96 20000731
(Red Hat Linux 7.1 2.96-96)

>as -v
GNU assembler version 2.10.91
(ia64-unknown-linux) using BFD version 2.10.91.0.2



================================================================

                         MODIFICATIONS:

================================================================

        1. Modification related with the definition of FLT_MAX

                osprey1.0/be/cg/cflow.cxx
                osprey1.0/be/cg/gra_mon/gra_lrange.cxx
                osprey1.0/be/cg/gra_mon/gra_split.cxx

                insert "#include <kpathsea/c-minmax.h>"

        2. Modification related with the definition of DBL_MAX

                osprey1.0/be/lno/doacross.cxx
                osprey1.0/be/lno/parallel.cxx
                osprey1.0/be/lno/cross_snl.cxx

	        insert "#include <kpathsea/c-minmax.h>"

        3. osprey1.0/common/com/ir_bcom.h

		line 56, replace "~addralign" by "~(off_t)addralign"

		cf. http://www.cs.ualberta.ca/~pengzhao/open64-devel/msg00088.html

        4. osprey1.0/driver/lang_defs.c

                In this file, some MACRO are set up to decide where
                the opencc related phase-binaries or libs are. Set
                these values properly can save you from the messy
                "-Y..." flags when you use the Open64 compiler. You
                can always the "-Y" flags to tell opencc where to find
                those phases or libs.
		
        5. Handle "cannot find sys/elf.h"

                osprey1.0/fake_ld/common/linker.h

                change sys/elf.h to asm/elf.h

        6. Add "-fpic" in the Makefiles for correctly generating ipa.so

                osprey1.0/ipa/inline/Makefile.gbase
                osprey1.0/ipa/local/Makefile.gbase
                osprey1.0/ipa/lw_inline/Makefile.gbase
                osprey1.0/ipa/main/Makefile.gbase

		At least osprey1.0/ipa/main/Makefile.gbase should be
		modified, I don't know is it necessary to modify the
		other three files.

        7. Use shared.pl

                (http://www.cs.ualberta.ca/~pengzhao/tmp/shared.pl) to
                modify the Makefiles so that we can utilize the
                Makefile.cross to natively build Open64 (I got it from
                Jin Lin and made some modifications)

	

Then you can use "make build -f Make.NUE.lib" to build the compiler.




Note:  

Kristof Beyls also gave a summary of his experience in installing ORC
natively on his Itanium machine. There are some differences between our
experiences but I think they are mostly system dependent. You can
check his mails in the ORC support list.

And again, thanks to Jin Lin, Lixia and Kristof.
